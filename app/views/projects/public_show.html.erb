<% provide(:page_title, @project.title) %>
<% provide(:meta_description, strip_tags(@project.funded_description.truncate(150))) if @project.funded_description %>
<% provide(:meta_image, image_url(@project.primary_image.url)) if @project.has_images? %>

<header class="project">
  <% if can_manage_chapter?(@project.chapter) %>
    <%= link_to t(".edit"), edit_project_path(@project), :class => 'edit-project' %>
  <% end %>
  <h1><%= @project.title %></h1>
</header>

<div class="images_gallery_wrapper">
  <%  gallery_bg_url = Rails.env.development? ? @project.display_images.last.url : @project.display_images.last.url(:main)  %>
  <div class="bg_primary" style="background-image: url(<%= gallery_bg_url %>);"></div>

  <div class="images_gallery" itemscope itemtype="http://schema.org/ImageGallery">
    <% @project.display_images.reverse_each do |image| %>
      <%  image_url = Rails.env.development? ? image.url : image.url(:main)  %>
      <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
        <a href="<%= image_url %>" itemprop="contentUrl" data-size="1024x1024">
          <img src="<%= image_url %>" itemprop="thumbnail" />
        </a>
        <figcaption itemprop="caption description"></figcaption>
      </figure>
    <% end %>
  </div>
</div>

<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="pswp__bg"></div>
  <div class="pswp__scroll-wrap">
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <div class="pswp__counter"></div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--share" title="Share"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip"></div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>

<section class="project-details">
  <section class="meta-data">
    <p><%= t(".byline-html", :chapter_name => link_to(@project.chapter.name, chapter_path(@project.chapter)), :submitter_name => @project.name) %></p>
    <div class="addthis_toolbox addthis_default_style ">
      <a class="addthis_button_twitter"></a>
      <a class="addthis_button_facebook"></a>
      <a class="addthis_button_google"></a>
      <a class="addthis_button_email"></a>
      <a class="addthis_button_compact"></a>
      <a class="addthis_counter addthis_bubble_style"></a>
    </div>
    <script type="text/javascript" src="https://s7.addthis.com/js/250/addthis_widget.js#pubid=ra-4f46fdff2154a73e"></script>
  </section>

  <section class="project-description">
    <% if @project.winner? %>
      <%= markdown @project.funded_description %>

    <% else %>
      <h2><%= t ".description.header" %></h2>
      <%= markdown @project.about_project %>

      <% if @project.extra_answer_1? %>
        <h2><%= @project.extra_question_1 %></h2>
        <p><%= @project.extra_answer_1 %></p>
      <% end %>

      <% if @project.extra_answer_2? %>
        <h2><%= @project.extra_question_2 %></h2>
        <p><%= @project.extra_answer_2 %></p>
      <% end %>

      <% if @project.extra_answer_3? %>
        <h2><%= @project.extra_question_3 %></h2>
        <p><%= @project.extra_answer_3 %></p>
      <% end %>
    <% end %>
  </section>

  <section class="project-side-bar">
    <article class="project-state">
      <% if @project.winner? %>
        <div class="state funded">
          <p><%= t(".funder-html", :name => @project.chapter.name) %> <span class="funded-on">(<%= l @project.funded_on, :format => :funding %>)</span></p>
        </div>
      <% else %>
        <div class="state applied">
          <p><%= t(".submitted-to-html", :name => @project.chapter.name) %></p>
        </div>
      <% end %>
    </article>

    <% if @project.url? %>
      <article class="project-site-link">
        <%= link_to @project.url do %>
          Visit this project's web site
          <span>â†’</span>
        <% end %>
      </article>
    <% end %>

    <% if @project.rss_feed_url? %>
      <article class="project-rss">
        <h2><%= t ".feed-title" %></h2>
        <section class="rss" id="rss-feeds"></section>
      </article>
      <% content_for :javascript do -%>
        <%= render 'shared/rssfeed', rss_feed_url: @project.rss_feed_url %>
      <% end -%>
    <% end %>

  </section>
</section>

<%= content_for :javascript do %>
  <%= javascript_tag do %>
    $(document).ready(function(){
      Slideshow("#project-gallery .piece").run();
    });
  <% end %>
<% end %>
